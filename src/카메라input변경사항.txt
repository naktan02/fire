camera.py 수정사항

원래

class Camera:
    def __init__(self, source=0):
        # 1) Windows에서 MSMF 대신 DSHOW 백엔드 먼저 시도
        self.cap = cv2.VideoCapture(source, cv2.CAP_DSHOW)
        
        # ... (생략)

에서

import cv2

class Camera:
    def __init__(self, source=0):
        """
        카메라를 초기화합니다.
        :param source: 카메라 인덱스(0) 또는 스트림 URL(문자열).
        """
        # [수정됨] 입력값이 문자열(URL)인 경우: 네트워크 스트림으로 처리 (DSHOW 사용 안 함)
        if isinstance(source, str):
            print(f"[INFO] 네트워크 스트림 접속 시도: {source}")
            self.cap = cv2.VideoCapture(source)
        
        # [유지] 입력값이 숫자(Int)인 경우: 로컬 USB 카메라로 처리
        else:
            # 1) Windows에서 MSMF 대신 DSHOW 백엔드 먼저 시도
            self.cap = cv2.VideoCapture(source, cv2.CAP_DSHOW)

            # 2) 만약 이게 안 되면 기본 백엔드로 한 번 더 시도
            if not self.cap.isOpened():
                print("[WARN] CAP_DSHOW로 열기 실패, 기본 백엔드로 재시도합니다.")
                self.cap = cv2.VideoCapture(source)

        if not self.cap.isOpened():
            raise ValueError("Could not open video source (index/url: {})".format(source))

    def get_frame(self):
        ret, frame = self.cap.read()
        return ret, frame

    def release(self):
        if self.cap is not None:
            self.cap.release()

으로 변경







main.py
def main():
    try:
        cam = Camera(1) # 카메라 인덱스 확인
    except Exception as e:
# ...
에서

def main():
    # [수정됨] 라즈베리파이 MJPG-Streamer 주소 입력
    # 주의: 뒤에 /?action=stream 까지 정확히 적어야 함
    STREAM_URL = "http://10.8.0.2:8080/?action=stream"

    try:
        print(f"Connecting to {STREAM_URL}...")
        cam = Camera(STREAM_URL) 
    except Exception as e:
# ...

으로

get_coords.py
def main():
    # 1) 카메라 인덱스 0 먼저 시도, 안 되면 1 시도
    cam = None
    cam = Camera(1)

    detector = Detector()
# ...

에서

def main():
    # [수정됨] 라즈베리파이 스트림 주소
    STREAM_URL = "http://10.8.0.2:8080/?action=stream"
    
    cam = None
    try:
        print(f"Connecting to {STREAM_URL}...")
        cam = Camera(STREAM_URL)
    except Exception as e:
        print(f"Error connecting to camera: {e}")
        return

    detector = Detector()
# ...

으로